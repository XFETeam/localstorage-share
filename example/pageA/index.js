!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.localstorageShare=t():e.localstorageShare=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_CLONE_ERROR=t.MESSAGE=t.REJECTED=t.FULFILLED=t.REPLY=t.CALL=t.HANDSHAKE_REPLY=t.HANDSHAKE=void 0;t.HANDSHAKE="handshake";t.HANDSHAKE_REPLY="handshake-reply";t.CALL="call";t.REPLY="reply";t.FULFILLED="fulfilled";t.REJECTED="rejected";t.MESSAGE="message";t.DATA_CLONE_ERROR="DataCloneError"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_NO_IFRAME_SRC=t.ERR_NOT_IN_IFRAME=t.ERR_CONNECTION_TIMEOUT=t.ERR_CONNECTION_DESTROYED=void 0;t.ERR_CONNECTION_DESTROYED="ConnectionDestroyed";t.ERR_CONNECTION_TIMEOUT="ConnectionTimeout";t.ERR_NOT_IN_IFRAME="NotInIframe";t.ERR_NO_IFRAME_SRC="NoIframeSrc"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeError=t.serializeError=void 0;t.serializeError=e=>{return{name:e.name,message:e.message,stack:e.stack}};t.deserializeError=e=>{const t=new Error;return Object.keys(e).forEach(n=>t[n]=e[n]),t}},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(4),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.serve="https://browniu.github.io/localstorage-share/"}var t,n,i;return t=e,(n=[{key:"init",value:function(){var e=document.createElement("iframe");e.src=this.serve,e.style.display="none",document.body.appendChild(e),this.connection=o({iframe:e})}},{key:"getItem",value:function(e,t){return this.getCallback=t,this.connection||this.init(),this.connection.promise.then((function(t){return t.get(e)}))}},{key:"setItem",value:function(e,t){return this.connection||this.init(),this.connection.promise.then((function(n){return n.set(e,t)}))}},{key:"removeItem",value:function(e){return this.connection||this.init(),this.connection.promise.then((function(t){return t.set(e,"")}))}},{key:"clear",value:function(){return this.connection||this.init(),this.connection.promise.then((function(e){return e.clear()}))}},{key:"getItems",value:function(){return this.connection||this.init(),this.connection.promise.then((function(e){return e.getAll()}))}}])&&r(t.prototype,n),i&&r(t,i),e}();e.exports=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(0),o=n(1),i=l(n(5)),a=l(n(6)),c=l(n(7)),s=l(n(8)),u=l(n(9));function l(e){return e&&e.__esModule?e:{default:e}}t.default=e=>{let t=e.iframe,n=e.methods,l=void 0===n?{}:n,d=e.childOrigin,f=e.timeout,E=e.debug;const p=(0,c.default)(E),h=window,v=(0,i.default)(),m=v.destroy,_=v.onDestroy;if(!d){if(!t.src&&!t.srcdoc){const e=new Error("Iframe must have src or srcdoc property defined.");throw e.code=o.ERR_NO_IFRAME_SRC,e}d=(0,a.default)(t.src)}const R="null"===d?"*":d;return{promise:new Promise((e,n)=>{let i;void 0!==f&&(i=setTimeout(()=>{const e=new Error(`Connection to child timed out after ${f}ms`);e.code=o.ERR_CONNECTION_TIMEOUT,n(e),m()},f));const a={};let c,E;const v=n=>{const o=t.contentWindow;if(n.source!==o||n.data.penpal!==r.HANDSHAKE)return;if(n.origin!==d)return void p(`Parent received handshake from origin ${n.origin} which did not match expected origin ${d}`);p("Parent: Received handshake, sending reply"),n.source.postMessage({penpal:r.HANDSHAKE_REPLY,methodNames:Object.keys(l)},R);const f={localName:"Parent",local:h,remote:o,originForSending:R,originForReceiving:d};E&&E(),E=(0,s.default)(f,l,p),_(E),c&&c.forEach(e=>{delete a[e]}),c=n.data.methodNames;const v=(0,u.default)(a,f,c,m,p);_(v),clearTimeout(i),e(a)};h.addEventListener(r.MESSAGE,v),p("Parent: Awaiting handshake");var g=setInterval(()=>{document.contains(t)||(clearInterval(g),m())},6e4);_(()=>{h.removeEventListener(r.MESSAGE,v),clearInterval(g);const e=new Error("Connection destroyed");e.code=o.ERR_CONNECTION_DESTROYED,n(e)})}),destroy:m}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=()=>{const e=[];let t=!1;return{destroy(){t=!0,e.forEach(e=>{e()})},onDestroy(n){t?n():e.push(n)}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;const r={"http:":"80","https:":"443"},o=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,i=["file:","data:"];t.default=e=>{if(e&&i.find(t=>e.startsWith(t)))return"null";const t=document.location,n=o.exec(e);let a,c,s;return n?(a=n[1]?n[1]:t.protocol,c=n[2],s=n[4]):(a=t.protocol,c=t.hostname,s=t.port),`${a}//${c}${s&&s!==r[a]?`:${s}`:""}`},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=e=>(function(){if(e){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];console.log("[Penpal]",...n)}}),e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(0),o=n(2);t.default=(e,t,n)=>{const i=e.localName,a=e.local,c=e.remote,s=e.originForSending,u=e.originForReceiving;let l=!1;n(`${i}: Connecting call receiver`);const d=e=>{if(e.source!==c||e.data.penpal!==r.CALL)return;if(e.origin!==u)return void n(`${i} received message from origin ${e.origin} which did not match expected origin ${u}`);const a=e.data,d=a.methodName,f=a.args,E=a.id;n(`${i}: Received ${d}() call`);const p=e=>t=>{if(n(`${i}: Sending ${d}() reply`),l)return void n(`${i}: Unable to send ${d}() reply due to destroyed connection`);const a={penpal:r.REPLY,id:E,resolution:e,returnValue:t};e===r.REJECTED&&t instanceof Error&&(a.returnValue=(0,o.serializeError)(t),a.returnValueIsError=!0);try{c.postMessage(a,s)}catch(e){throw e.name===r.DATA_CLONE_ERROR&&c.postMessage({penpal:r.REPLY,id:E,resolution:r.REJECTED,returnValue:(0,o.serializeError)(e),returnValueIsError:!0},s),e}};new Promise(e=>e(t[d].apply(t,f))).then(p(r.FULFILLED),p(r.REJECTED))};return a.addEventListener(r.MESSAGE,d),()=>{l=!0,a.removeEventListener(r.MESSAGE,d)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=n(0),i=n(1),a=(r=n(10))&&r.__esModule?r:{default:r},c=n(2);t.default=(e,t,n,r,s)=>{const u=t.localName,l=t.local,d=t.remote,f=t.originForSending,E=t.originForReceiving;let p=!1;s(`${u}: Connecting call sender`);return n.reduce((e,t)=>(e[t]=(e=>(function(){for(var t=arguments.length,n=new Array(t),h=0;h<t;h++)n[h]=arguments[h];let v;s(`${u}: Sending ${e}() call`);try{d.closed&&(v=!0)}catch(e){v=!0}if(v&&r(),p){const t=new Error(`Unable to send ${e}() call due `+"to destroyed connection");throw t.code=i.ERR_CONNECTION_DESTROYED,t}return new Promise((t,r)=>{const i=(0,a.default)(),p=n=>{if(n.source!==d||n.data.penpal!==o.REPLY||n.data.id!==i)return;if(n.origin!==E)return void s(`${u} received message from origin ${n.origin} which did not match expected origin ${E}`);s(`${u}: Received ${e}() reply`),l.removeEventListener(o.MESSAGE,p);let a=n.data.returnValue;n.data.returnValueIsError&&(a=(0,c.deserializeError)(a)),(n.data.resolution===o.FULFILLED?t:r)(a)};l.addEventListener(o.MESSAGE,p),d.postMessage({penpal:o.CALL,id:i,methodName:e,args:n},f)})}))(t),e),e),()=>{p=!0}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;let r=0;t.default=()=>++r,e.exports=t.default}])}));