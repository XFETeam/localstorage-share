!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.localstorageShare=t():e.localstorageShare=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DATA_CLONE_ERROR=t.MESSAGE=t.REJECTED=t.FULFILLED=t.REPLY=t.CALL=t.HANDSHAKE_REPLY=t.HANDSHAKE=void 0;t.HANDSHAKE="handshake";t.HANDSHAKE_REPLY="handshake-reply";t.CALL="call";t.REPLY="reply";t.FULFILLED="fulfilled";t.REJECTED="rejected";t.MESSAGE="message";t.DATA_CLONE_ERROR="DataCloneError"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERR_NO_IFRAME_SRC=t.ERR_NOT_IN_IFRAME=t.ERR_CONNECTION_TIMEOUT=t.ERR_CONNECTION_DESTROYED=void 0;t.ERR_CONNECTION_DESTROYED="ConnectionDestroyed";t.ERR_CONNECTION_TIMEOUT="ConnectionTimeout";t.ERR_NOT_IN_IFRAME="NotInIframe";t.ERR_NO_IFRAME_SRC="NoIframeSrc"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deserializeError=t.serializeError=void 0;t.serializeError=function(e){return{name:e.name,message:e.message,stack:e.stack}};t.deserializeError=function(e){var t=new Error;return Object.keys(e).forEach((function(n){return t[n]=e[n]})),t}},function(e,t,n){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=n(4),i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.serve="https://browniu.github.io/localstorage-share/"}var t,n,i;return t=e,(n=[{key:"init",value:function(){var e=document.createElement("iframe");e.src=this.serve,e.style.display="none",document.body.appendChild(e),this.connection=o({iframe:e})}},{key:"getItem",value:function(e,t){return this.getCallback=t,this.connection||this.init(),this.connection.promise.then((function(t){return t.get(e)}))}},{key:"setItem",value:function(e,t){return this.connection||this.init(),this.connection.promise.then((function(n){return n.set(e,t)}))}},{key:"removeItem",value:function(e){return this.connection||this.init(),this.connection.promise.then((function(t){return t.set(e,"")}))}},{key:"clear",value:function(){return this.connection||this.init(),this.connection.promise.then((function(e){return e.clear()}))}},{key:"getItems",value:function(){return this.connection||this.init(),this.connection.promise.then((function(e){return e.getAll()}))}}])&&r(t.prototype,n),i&&r(t,i),e}();e.exports=new i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(0),o=n(1),i=s(n(5)),a=s(n(6)),c=s(n(7)),u=s(n(8)),l=s(n(9));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){var t=e.iframe,n=e.methods,s=void 0===n?{}:n,d=e.childOrigin,f=e.timeout,E=e.debug,v=(0,c.default)(E),p=window,h=(0,i.default)(),m=h.destroy,_=h.onDestroy;if(!d){if(!t.src&&!t.srcdoc){var R=new Error("Iframe must have src or srcdoc property defined.");throw R.code=o.ERR_NO_IFRAME_SRC,R}d=(0,a.default)(t.src)}var g="null"===d?"*":d;return{promise:new Promise((function(e,n){var i;void 0!==f&&(i=setTimeout((function(){var e=new Error("Connection to child timed out after ".concat(f,"ms"));e.code=o.ERR_CONNECTION_TIMEOUT,n(e),m()}),f));var a,c,E={},h=function(n){var o=t.contentWindow;if(n.source===o&&n.data.penpal===r.HANDSHAKE)if(n.origin===d){v("Parent: Received handshake, sending reply"),n.source.postMessage({penpal:r.HANDSHAKE_REPLY,methodNames:Object.keys(s)},g);var f={localName:"Parent",local:p,remote:o,originForSending:g,originForReceiving:d};c&&c(),c=(0,u.default)(f,s,v),_(c),a&&a.forEach((function(e){delete E[e]})),a=n.data.methodNames;var h=(0,l.default)(E,f,a,m,v);_(h),clearTimeout(i),e(E)}else v("Parent received handshake from origin ".concat(n.origin," which did not match expected origin ").concat(d))};p.addEventListener(r.MESSAGE,h),v("Parent: Awaiting handshake");var R=setInterval((function(){document.contains(t)||(clearInterval(R),m())}),6e4);_((function(){p.removeEventListener(r.MESSAGE,h),clearInterval(R);var e=new Error("Connection destroyed");e.code=o.ERR_CONNECTION_DESTROYED,n(e)}))})),destroy:m}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(){var e=[],t=!1;return{destroy:function(){t=!0,e.forEach((function(e){e()}))},onDestroy:function(n){t?n():e.push(n)}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={"http:":"80","https:":"443"},o=/^(https?:)?\/\/([^/:]+)?(:(\d+))?/,i=["file:","data:"];t.default=function(e){if(e&&i.find((function(t){return e.startsWith(t)})))return"null";var t,n,a,c=document.location,u=o.exec(e);u?(t=u[1]?u[1]:c.protocol,n=u[2],a=u[4]):(t=c.protocol,n=c.hostname,a=c.port);var l=a&&a!==r[t]?":".concat(a):"";return"".concat(t,"//").concat(n).concat(l)},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(e){return function(){if(e){for(var t,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];(t=console).log.apply(t,["[Penpal]"].concat(r))}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=n(0),o=n(2);t.default=function(e,t,n){var i=e.localName,a=e.local,c=e.remote,u=e.originForSending,l=e.originForReceiving,s=!1;n("".concat(i,": Connecting call receiver"));var d=function(e){if(e.source===c&&e.data.penpal===r.CALL)if(e.origin===l){var a=e.data,d=a.methodName,f=a.args,E=a.id;n("".concat(i,": Received ").concat(d,"() call"));var v=function(e){return function(t){if(n("".concat(i,": Sending ").concat(d,"() reply")),s)n("".concat(i,": Unable to send ").concat(d,"() reply due to destroyed connection"));else{var a={penpal:r.REPLY,id:E,resolution:e,returnValue:t};e===r.REJECTED&&t instanceof Error&&(a.returnValue=(0,o.serializeError)(t),a.returnValueIsError=!0);try{c.postMessage(a,u)}catch(e){throw e.name===r.DATA_CLONE_ERROR&&c.postMessage({penpal:r.REPLY,id:E,resolution:r.REJECTED,returnValue:(0,o.serializeError)(e),returnValueIsError:!0},u),e}}}};new Promise((function(e){return e(t[d].apply(t,f))})).then(v(r.FULFILLED),v(r.REJECTED))}else n("".concat(i," received message from origin ").concat(e.origin," which did not match expected origin ").concat(l))};return a.addEventListener(r.MESSAGE,d),function(){s=!0,a.removeEventListener(r.MESSAGE,d)}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,o=n(0),i=n(1),a=(r=n(10))&&r.__esModule?r:{default:r},c=n(2);t.default=function(e,t,n,r,u){var l=t.localName,s=t.local,d=t.remote,f=t.originForSending,E=t.originForReceiving,v=!1;u("".concat(l,": Connecting call sender"));return n.reduce((function(e,t){return e[t]=function(e){return function(){for(var t=arguments.length,n=new Array(t),p=0;p<t;p++)n[p]=arguments[p];var h;u("".concat(l,": Sending ").concat(e,"() call"));try{d.closed&&(h=!0)}catch(e){h=!0}if(h&&r(),v){var m=new Error("Unable to send ".concat(e,"() call due ")+"to destroyed connection");throw m.code=i.ERR_CONNECTION_DESTROYED,m}return new Promise((function(t,r){var i=(0,a.default)();s.addEventListener(o.MESSAGE,(function n(a){if(a.source===d&&a.data.penpal===o.REPLY&&a.data.id===i)if(a.origin===E){u("".concat(l,": Received ").concat(e,"() reply")),s.removeEventListener(o.MESSAGE,n);var f=a.data.returnValue;a.data.returnValueIsError&&(f=(0,c.deserializeError)(f)),(a.data.resolution===o.FULFILLED?t:r)(f)}else u("".concat(l," received message from origin ").concat(a.origin," which did not match expected origin ").concat(E))})),d.postMessage({penpal:o.CALL,id:i,methodName:e,args:n},f)}))}}(t),e}),e),function(){v=!0}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=0;t.default=function(){return++r},e.exports=t.default}])}));